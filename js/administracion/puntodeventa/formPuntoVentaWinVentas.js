/*
 * File: formPuntoVentaWinVentas.js
 * Date: Sun Jun 11 2017 16:13:12 GMT-0600 (Hora verano, Montañas (México))
 * 
 * This file was generated by Ext Designer version 1.1.2.
 * http://www.sencha.com/products/designer/
 *
 * This file will be generated the first time you export.
 *
 * You should implement event handling and custom methods in this
 * class.
 */

formPuntoVentaWinVentas = Ext.extend(formPuntoVentaWinVentasUi, {
	renderPrecio:function(val,x,rec){
		return "$"+Ext.util.Format.monedaConSeparadorDeMiles(val);
	},
	inicializarRenders:function(){
		var colModel=this.gridVentas.getColumnModel();
        var columna=colModel.getColumnById('colTotalVenta');
        columna.renderer=this.renderPrecio
	},	
   inicializarStores:function(){
			this.gridVentas.store=new miErpWeb.storePuntoVentaWinVentas();
			this.gridVentas.bottomToolbar.bindStore(this.gridVentas.store);
			this.gridVentas.bottomToolbar.pageSize=miErpWeb.parametros.registros_pagina;
			//this.gridCancelados.bottomToolbar.bind(this.gridCancelados.store);
	},
	inicializarEvents:function(){
			var dt = new Date();			
			this.txtFechaInicio.setValue(dt);
			this.txtFechaFin.setValue(dt);
			this.gridVentas.store.on('beforeload',function(){
				this.gridVentas.store.baseParams=this.gridVentas.store.baseParams || {};
				this.gridVentas.store.baseParams.fechainicio=this.txtFechaInicio.getValue().dateFormat('Y-m-d');
				this.gridVentas.store.baseParams.fechafin=this.txtFechaFin.getValue().dateFormat('Y-m-d');
				this.gridVentas.store.baseParams.id_empresa=miErpWeb.Empresa[0].id_empresa;
				this.gridVentas.store.baseParams.id_sucursal=miErpWeb.Sucursal[0].id_sucursal;
				this.gridVentas.store.baseParams.folio=this.txtSerieFolioBusqueda.getValue() || '';
				//this.gridVentas.store.baseParams.start=0;
				//this.gridVentas.store.baseParams.limit=miErpWeb.parametros.registros_pagina;
								
			},this);
					
			this.gridVentas.store.on('load',function(){
				this.el.unmask();
			},this);
			
			this.btnFiltro.on('click',function(){
				//this.gridVentas.store.reload();
				this.gridVentas.bottomToolbar.doRefresh();	
			},this);
			
			this.gridVentas.on("keydown", function(e){
				if(e.getKey()==13){
					this.fireEvent("ventaSeleccionada", this.gridVentas.getSelectionModel().getSelected().data.id_venta,this.gridVentas.getSelectionModel().getSelected().data.serie_folio);
					this.close();
				}
			}, this);

			this.gridVentas.on("celldblclick", function(){
				this.fireEvent("ventaSeleccionada", this.gridVentas.getSelectionModel().getSelected().data.id_venta,this.gridVentas.getSelectionModel().getSelected().data.serie_folio);
				this.close();
			}, this);

					
	},
	initComponent: function() {
        formPuntoVentaWinVentas.superclass.initComponent.call(this);
		this.inicializarStores();
		this.inicializarEvents();
		this.inicializarRenders();
    }
});
Ext.reg('formPuntoVentaWinVentas', formPuntoVentaWinVentas);